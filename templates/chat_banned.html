{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Banned • Vixogram</title>

    <link rel="icon" type="image/png" href="{% static 'favicon.png' %}">
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.png' %}">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: Inter, ui-sans-serif, system-ui, sans-serif; }
        .vixo-glow {
            box-shadow:
              0 0 0 1px rgba(255,255,255,.08),
              0 30px 90px rgba(0,0,0,.65);
        }
        .vixo-grid {
            background-image:
              radial-gradient(circle at 1px 1px, rgba(255,255,255,.06) 1px, transparent 0);
            background-size: 28px 28px;
        }
    </style>
</head>
<body class="h-full min-h-[100dvh] bg-gradient-to-b from-gray-950 via-gray-900 to-gray-950 text-white">
    <div class="min-h-[100dvh] flex items-center justify-center px-4 py-6 sm:py-10">
        <div class="relative w-full max-w-3xl">
            <div aria-hidden="true" class="pointer-events-none absolute -top-28 -left-20 h-72 w-72 rounded-full bg-red-500/10 blur-3xl"></div>
            <div aria-hidden="true" class="pointer-events-none absolute -bottom-24 -right-16 h-80 w-80 rounded-full bg-amber-400/10 blur-3xl"></div>

            <div class="relative rounded-3xl border border-white/10 bg-gray-900/50 backdrop-blur overflow-hidden vixo-glow">
                <div class="vixo-grid absolute inset-0 opacity-40"></div>
                <div aria-hidden="true" class="absolute inset-x-0 top-0 h-[2px] bg-gradient-to-r from-red-500 via-amber-400/80 to-orange-500"></div>

                <div class="relative px-6 sm:px-10 py-10 sm:py-12">
                    <div class="flex items-center justify-center gap-3">
                        <img src="{% static 'vixologo.png' %}" alt="Vixogram" class="h-12 w-auto" />
                    </div>

                    <div class="mt-10 text-center">
                        <div class="mx-auto inline-flex h-20 w-20 items-center justify-center rounded-2xl border border-red-400/30 bg-red-500/10 text-red-200">
                            <svg viewBox="0 0 24 24" class="h-10 w-10" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M9 9a3 3 0 1 1 6 0v2" />
                                <rect x="5" y="11" width="14" height="10" rx="2" />
                                <path d="M9 16h6" />
                            </svg>
                        </div>

                        <div class="mt-5 text-3xl sm:text-4xl font-extrabold tracking-wide text-red-200">Chat Access Banned</div>
                        <p class="mt-4 text-sm sm:text-base text-gray-300 max-w-xl mx-auto">
                            You are temporarily banned from reading and sending chat messages.
                        </p>

                        <div class="mt-6 mx-auto max-w-xl rounded-2xl border border-white/10 bg-gray-900/70 p-4 sm:p-5 text-left">
                            <div class="grid gap-3 sm:grid-cols-2">
                                <div class="rounded-xl border border-gray-800 bg-gray-900/60 px-4 py-3">
                                    <div class="text-[11px] uppercase tracking-wide text-gray-400">Ban ends at</div>
                                    <div class="mt-1 text-sm sm:text-base font-semibold text-gray-100">{{ ban_until_display|default:'Unknown' }}</div>
                                </div>
                                <div class="rounded-xl border border-gray-800 bg-gray-900/60 px-4 py-3">
                                    <div class="text-[11px] uppercase tracking-wide text-gray-400">Time remaining</div>
                                    <div id="ban_countdown" data-seconds="{{ ban_remaining_seconds|default:0 }}" class="mt-1 text-sm sm:text-base font-semibold text-amber-200">{{ ban_remaining_display|default:'Unknown' }}</div>
                                </div>
                            </div>
                            <div class="mt-3 text-xs text-gray-400">If this looks incorrect, contact support or wait until the timer ends.</div>
                        </div>
                    </div>

                    <div class="mt-10 flex flex-wrap items-center justify-center gap-3">
                        <button type="button" id="ban_refresh_btn" class="inline-flex items-center justify-center rounded-full border border-white/10 bg-gray-800/60 hover:bg-gray-800 px-6 py-2.5 text-sm font-semibold transition">
                            Refresh
                        </button>
                        <a href="/" class="inline-flex items-center justify-center rounded-full border border-amber-400/30 bg-amber-500/15 hover:bg-amber-500/20 text-amber-200 px-6 py-2.5 text-sm font-semibold transition">
                            Home
                        </a>
                    </div>

                    <div class="mt-10 pt-6 border-t border-white/10 text-center text-xs text-gray-400">
                        © {% now "Y" %} Vixogram
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const el = document.getElementById('ban_countdown');
            if (!el) return;
            const refreshBtn = document.getElementById('ban_refresh_btn');

            const toInt = (v) => {
                const n = parseInt(String(v || '0'), 10);
                return Number.isFinite(n) ? n : 0;
            };

            let secondsLeft = Math.max(0, toInt(el.getAttribute('data-seconds')));
            const chatRedirectUrl = "{{ ban_redirect_url|default:'/chat/room/public-chat'|escapejs }}";

            const formatRemaining = (totalSeconds) => {
                const sec = Math.max(0, toInt(totalSeconds));
                if (sec <= 0) return 'expired';

                const days = Math.floor(sec / 86400);
                const hours = Math.floor((sec % 86400) / 3600);
                const minutes = Math.floor((sec % 3600) / 60);
                const seconds = sec % 60;

                const parts = [];
                if (days > 0) parts.push(`${days}d`);
                if (hours > 0 || days > 0) parts.push(`${hours}h`);
                if (minutes > 0 || hours > 0 || days > 0) parts.push(`${minutes}m`);
                parts.push(`${seconds}s`);

                return parts.join(' ');
            };

            const render = () => {
                el.textContent = formatRemaining(secondsLeft);
            };

            const redirectToChat = () => {
                try {
                    window.location.assign(chatRedirectUrl);
                } catch {
                    window.location.href = chatRedirectUrl;
                }
            };

            if (refreshBtn) {
                refreshBtn.addEventListener('click', redirectToChat);
            }

            render();

            if (secondsLeft <= 0) {
                window.setTimeout(redirectToChat, 300);
                return;
            }

            const timer = window.setInterval(() => {
                secondsLeft = Math.max(0, secondsLeft - 1);
                render();
                if (secondsLeft <= 0) {
                    window.clearInterval(timer);
                    window.setTimeout(redirectToChat, 300);
                }
            }, 1000);
        })();
    </script>
</body>
</html>
