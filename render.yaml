services:
  - type: web
    name: vixogram
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt && python manage.py collectstatic --noinput
    startCommand: python manage.py migrate --noinput && daphne -b 0.0.0.0 -p $PORT a_core.asgi:application
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "False"
      # Set these in Render Dashboard (do NOT commit secrets):
      # - SECRET_KEY
      # - DATABASE_URL
      # - REDIS_URL (optional but recommended for Channels in production)
      # - FIREBASE_ENABLED ("True"/"False")
      # - FIREBASE_API_KEY
      # - FIREBASE_AUTH_DOMAIN
      # - FIREBASE_PROJECT_ID
      # - FIREBASE_STORAGE_BUCKET
      # - FIREBASE_MESSAGING_SENDER_ID
      # - FIREBASE_APP_ID
      # - FIREBASE_MEASUREMENT_ID (optional)
      # - FIREBASE_VAPID_PUBLIC_KEY
      # - FIREBASE_SERVICE_ACCOUNT_B64 (recommended) OR FIREBASE_SERVICE_ACCOUNT_JSON
      # - AGORA_APP_ID
      # - AGORA_APP_CERTIFICATE
      # - CLOUD_NAME / API_KEY / API_SECRET
      # - EMAIL_HOST_USER / EMAIL_HOST_PASSWORD
      # - PBKDF2_ITERATIONS (optional: reduce login/signup latency on low-CPU hosts; try 150000)

  - type: cron
    name: vixogram-purge-old-messages
    env: python
    schedule: "0 * * * *"
    command: python manage.py purge_old_messages --days 2 --batch 500
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "False"

  - type: cron
    name: vixogram-purge-old-rooms
    env: python
    schedule: "15 * * * *"
    command: python manage.py purge_old_rooms --days 4 --batch 50
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "False"


