{% extends 'base.html' %}
{% load static %}

{% block content %}
<wrapper class="block w-full max-w-xl mx-auto px-4 sm:px-6 py-6 sm:py-8">
  <div class="rounded-2xl border border-gray-800 bg-gray-900/60 shadow-2xl shadow-black/30 overflow-hidden">
    <div class="px-5 sm:px-6 py-4 border-b border-gray-800 flex items-center justify-between gap-3">
      <div>
        <div class="text-lg font-extrabold text-white">Add Story</div>
        <div class="mt-1 text-xs text-gray-400">Images only • Shows {{ duration_seconds }}s • Expires in {{ ttl_hours }} hours</div>
      </div>
      <a href="{% url 'profile' %}" class="text-xs sm:text-sm text-gray-200 hover:text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition">Back</a>
    </div>

    <form method="post" enctype="multipart/form-data" class="px-5 sm:px-6 py-5 space-y-4" data-loading-text="Uploading…">
      {% csrf_token %}

      <input type="hidden" name="cropped_image_data" id="story_cropped_image_data" value="" />

      {% if form.non_field_errors %}
        <div class="rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-3 text-sm text-red-100">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <div>
        <label class="block text-sm font-semibold text-gray-200 mb-2">Select image</label>

        <input
          id="story_image_input"
          name="image"
          type="file"
          accept="image/*"
          class="hidden"
          required
        />

        <div class="flex items-center gap-3">
          <button type="button" id="story_select_btn" class="inline-flex items-center justify-center rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-100 text-sm border border-white/10 px-4 py-2">
            Select image
          </button>
          <div id="story_file_name" class="text-xs text-gray-400 truncate">No image selected</div>
        </div>

        {% if form.image.errors %}
          <div class="mt-2 text-sm text-red-300">{{ form.image.errors }}</div>
        {% endif %}
        <div class="mt-2 text-xs text-gray-400">Tip: Best looks in portrait (9:16).</div>
      </div>

      <div id="story_crop_wrap" class="hidden">
        <div class="mt-2 rounded-xl border border-white/10 bg-black/20 p-3">
          <div class="text-xs font-semibold text-gray-200 mb-2">Crop</div>
          <div class="w-full max-h-[60vh] overflow-hidden rounded-lg bg-black/40">
            <img id="story_crop_img" alt="Selected" class="max-w-full block" />
          </div>
          <div class="mt-3 flex items-center justify-between gap-3">
            <div class="text-xs text-gray-400">Drag to crop • pinch/scroll to zoom</div>
            <button type="button" id="story_reset_crop" class="text-xs text-gray-200 hover:text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition">Reset</button>
          </div>
        </div>
      </div>

      <div class="flex items-center justify-end gap-3">
        <a href="{% url 'profile' %}" class="text-sm text-gray-200 hover:text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition">Cancel</a>
        <button type="submit" class="text-sm font-extrabold text-white px-5 py-2 rounded-lg bg-gradient-to-r from-purple-500 via-indigo-500 to-sky-500 hover:from-purple-400 hover:via-indigo-400 hover:to-sky-400 transition">
          Put Story
        </button>
      </div>
    </form>
  </div>
</wrapper>

{% endblock %}
